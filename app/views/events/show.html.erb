<div class="container">
  <div class="row">
    <div class="col-md-12">
      <table class="table table-secondary table-hover table-inverse text-center">
        <thead>
          <tr>
            <th>User</th>
            <th>タイトル</th>
            <th class="text-break">概要&nbsp;&nbsp;【投稿者は概要リンクをクリックすると編集できます】</th>
            <th>場所</th>
            <th></th>
            <th>開始</th>
            <th>終了</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>
              <%= link_to user_path(@user) do %>
                <%= attachment_image_tag @user, :profile_image, :fill, 100, 100, format: 'jpeg', fallback: "no_image.jpg", size: "50x50" %>
              <% end %>
            </td>
            <td><%= @event.title %></td>
            <td>
              <!--投稿者にだけイベントの編集権限を付与-->
              <% if @user == current_user %>
                <%= link_to @event.body, edit_event_path(@event) %>
              <% else %>
                <%= @event.body %>
              <% end %>
            </td>
            <td><%= @event.location %></td>
            <!--自分の投稿か否かをここから判断-->
            <% if current_user.own?(@event) %>
              <td>
                <i class="far fa-heart" style="font-size: 20px;"><%= @event.favorites.count %></i>
                <p>コメント件数:&nbsp;<%= @event.event_comments.count %></p>
              </td>
            <% else %>
              <td>
                <div id="favorite_buttons_<%= @event.id %>">
                  <%= render "favorites/favorite_button", event: @event %>
                </div>
                <p>コメント件数:&nbsp;<%= @event.event_comments.count %></p>
              </td>
            <% end %>
            <td><%= @event.start_date.strftime("%Y,%m/%d %H:%M") %></td>
            <td><%= @event.end_date.strftime("%Y,%m/%d %H:%M") %></td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
  <!--コメント一覧を表示する-->
  <% @event.event_comments.each do |event_comment| %>
    <!--もしコメントしたユーザーとログインしているユーザーが一致している場合表示を変更する。-->
    <% if event_comment.user == current_user %>
      <%= render "event_comments/event_comment", event_comment: event_comment %>
    <% else %>
      <div class="row">
        <div class="col-1 px-0">
          <div class="row" style="width: 1%;">
            <div class="col-1">
              <%= attachment_image_tag event_comment.user, :profile_image, :fill, 100, 100, format: 'jpeg', fallback: "no_image.jpg", size: "40x40" %>
            </div>
          </div>
          <div class="row px-2">
            <%= event_comment.user.name %>
          </div>
          <div class="row px-2">
            <%= event_comment.created_at.strftime("%m/%d %H:%M") %>
          </div>
        </div>
        <%= event_comment.comment %>
      </div>
    <% end %>
  <% end %>
  <!--コメント投稿フォームを表示する-->
  <div class="row">
    <%= form_with(model:[@event, @event_comment], local: true) do |f| %>
      <%= f.text_area :comment, rows:'5',placeholder: "コメント投稿欄", class:"form-control" %>
      <div class="col-12 d-flex justify-content-end my-2">
        <%= f.submit "送信", class:"btn btn-outline-info" %>
      </div>
    <% end %>
  </div>
</div>